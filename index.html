<!DOCTYPE html><html lang="pt_BR"><head><meta charset="utf8"/><title>Perfil do profissional</title><style>        /* Estilo da barra de navegação */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333; /* Cor de fundo da barra de navegação */
            color: #fff; /* Cor do texto da barra de navegação */
            padding: 10px 0;
        }

        .navbar a {
            color: #fff;
            text-decoration: none;
            padding: 15px;
        }

        /* Adicione margem ao corpo para evitar que o conteúdo fique oculto sob a barra de navegação */
        body {
            margin-top: 60px; /* Ajuste conforme necessário com base na altura da sua barra de navegação */
        }
        td {
            /*border: 1px solid #dfe2e5;*/
            background-color: transparent !important;
            border: 0 !important;
        }

        tr {
          border: 1px solid #dfe2e5 !important;
          background: transparent!important;
        }

        .tr:hover {
            background: #DFE2E5!important;
            cursor: pointer!important;
        }

        .tr:pressed {
            background: #9FA1A3!important;
        }

        .header {
            background-color: #F6F8FA !important;
        }

        .no-border {
            border: 0px solid #dfe2e5 !important;
        }

        ::backdrop {
          background-image: linear-gradient(
            45deg,
            rgb(0, 0, 0),
            rgb(0, 0, 0)
            );
          opacity: 0.75;
        }




      </style><meta content="lua-wpp" name="generator"/><meta content="width=device-width,initial-scale=1.0" name="viewport"/><link href="assets/css/style.css" rel="stylesheet"/>
      <script  src="https://unpkg.com/@supabase/supabase-js@2"></script>
      <script>
      const supabaseUrl = 'https://lsnvjibgvbjxqctmnteg.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxzbnZqaWJndmJqeHFjdG1udGVnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyODkyMjg2MywiZXhwIjoyMDQ0NDk4ODYzfQ.gW6JvgYrpYRU2K332UPr03-haZA2vLM4SQduOkocI_k';
window.supabase = supabase.createClient(supabaseUrl, supabaseKey);
      </script>
      </head>
      <body class="container-lg px-3 my-5 markdown-body"><div class="navbar"><a href="#"><span>Página inicial</span><span></span></a></div>

      <h3><br></h3>
      <table>
        <tr onclick="document.getElementById('login').showModal();" class="tr">
          <td><img src="assets/img/login.png" width="96" /></td>
          <td>
            <b>Acesso do profissional</b><br />Acesse sua produção individual, banco de horas e afins
          </td>
        </tr>
      </table>


      <dialog id="login" style="border: 0;">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td>CPF: </td>
            <td><input type="text" id="cpf" oninput="applyCPFFormat(this)" style="padding-left: 6;"></td>
          </tr>
          <tr class="no-border">
            <td>Senha: </td>
            <td><input id="senha" type="password"></td>
          </tr>
          <tr class="no-border">
            <td><button onclick="document.getElementById('login').close();document.getElementById('changeFirstPassword').close();">Cancelar</button></td>
            <td align="right"> <button onclick="login();">Acessar</button></td>
          </tr>
          <tr class="no-border">
            <td colspan="2"><a href="" onclick="event.preventDefault();document.getElementById('changeFirstPassword').showModal();">Primeiro acesso com senha</a></td>
          </tr>
        </table>
      </dialog>

      <dialog id="changeFirstPassword" style="border: 0;">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td colspan="2">Olá, bem-vindo(a) agora o acesso é feito através de login e senha,<br>Digite o seu CPF e a senha que deseja usar<br><br></td>
          </tr>
          <tr class="no-border">
            <td>CPF: </td>
            <td><input type="text" id="novoCPF" oninput="applyCPFFormat(this)" style="padding-left: 6;"></td>
          </tr>
          <tr class="no-border">
            <td>Nova senha: </td>
            <td><input id="novaSenha" type="password"></td>
          </tr>
          <tr class="no-border">
            <td>Repita a senha: </td>
            <td><input id="novaSenhaConfirmar" type="password"></td>
          </tr>
          <tr class="no-border">
            <td>&nbsp;</td>
          </tr>
          <tr class="no-border">
            <td><button onclick="document.getElementById('login').close();document.getElementById('changeFirstPassword').close();">Cancelar</button></td>
            <td align="right"> <button onclick="event.preventDefault();signup();">Acessar</button></td>
          </tr>
        </table>
        <p style="color: red;" id="erroPrimeiroAcesso"></p>
      </dialog>

      <dialog id="loginErro" style="border: 0;" onclick="document.getElementById('loginErro').close()">
        <table style="border: 0;">

          <tr class="no-border">
            <td colspan="2" style="text-align: center; vertical-align: middle;"><img src="assets/img/cidade-logo.png" width="96"></td>
          </tr>
          <tr class="no-border">
            <td colspan="2"><h3>Não foi possível realizar o login!</h3>Se for a primeira vez que faz login com senha, clique em "Primeiro acesso"<br><br></td>
          </tr>
          <tr class="no-border">
            <td>&nbsp;</td>
          </tr>
        </table>
      </dialog>

      <script src="js/Profissionais-cadastrados.js"></script>
      <script src="assets/js/logout.js"></script>
      <script>

function applyCPFFormat(input) {
    // Remove non-numeric characters
    let value = input.value.replace(/\D/g, '');
    let cpf = value;
    let cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
    // Apply CPF mask


    value = value.replace(/^(\d{3})(\d{3})(\d{3})(\d{2}).*/, '$1.$2.$3-$4');

    if (cpfRegex.test(value)) {
      let cod_cpf = parseInt((cpf).substr(3,6)).toString(36);
      for (let cadastro of Profissionais){
        if (cadastro[3] == cod_cpf) {
          document.getElementById("nome").innerText=cadastro[1].split(" ")[0];
          break
        }
      }
    }

    // Update input value
    input.value = value;
}

async function signup() {
  if (document.getElementById("novoCPF").value == "") {
    document.getElementById("erroPrimeiroAcesso").innerText = "CPF não pode estar em branco";
    return;
  }

  if (document.getElementById("novaSenha").value == "") {
    document.getElementById("erroPrimeiroAcesso").innerText = "A senha não pode ficar em branco";
    return;
  }

  if (document.getElementById("novaSenha").value != document.getElementById("novaSenhaConfirmar").value) {
    document.getElementById("erroPrimeiroAcesso").innerText = "A senha digitada não confere";
    return;
  }

  let { data, error } = await window.supabase.auth.signUp({
  email: `${parseInt(document.getElementById("novoCPF").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`,
  password: document.getElementById("novaSenha").value,
})
  if (!error) {
    document.getElementById('changeFirstPassword').close();
    return;
  }

  console.log(error)


  // mensagem erro
}

async function loadPage() {
  let a = document.createElement("a");
  a.href = "profissional.html";
  a.click();
}

async function cacheProfissional() {
  const { data, error } = await supabase
  .from('profissional')
  .select()
  .eq('login_id', parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36));

  if (error) {
    document.getElementById('loginErro').showModal();
    return;
  }

  localStorage.setItem("cod_profissional", data[0].profissional_cod);
  localStorage.setItem("profissional_equipes", data[0].profissional_equipes);
  localStorage.setItem("profissional_pagina", data[0].profissional_pagina);

  loadPage();
}

async function login() {
  document.getElementById('login').close();
  const { data, error } = await supabase.auth.signInWithPassword({
    email: `${parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`,
    password: `${document.getElementById("senha").value}`,
  })

  if (error) {
    document.getElementById('loginErro').showModal();
    return;
  }
  localStorage.setItem("profissional", `${parseInt(document.getElementById("cpf").value.replaceAll(".","").replaceAll("-","")).toString(36)}@profissional.ext`);

  location.href = "profissional.html";
}

async function changeFirstPassword() {
  await supabase.auth.updateUser({ password: `${document.getElementById("senha").value}` })
}

if (localStorage.getItem("profissional")) {
  loadPage();
}


      </script>
      </body></html>
